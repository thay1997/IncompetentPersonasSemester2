import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Iterator;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import com.google.gson.JsonElement;
import com.google.gson.JsonParser;

import org.json.*;
import org.json.simple.parser.JSONParser;

// Read me
// Need to add org.json, org.json.simple & gson libraries via Jar files to run code

public class FileHandler {
    
    String jsonFile;

    // Main to test
    public static void main(String[] args) {
        
        // Create FileHandler Object
        FileHandler fileHandler = new FileHandler();

        // Write the file
        fileHandler.fileWrite();

        // Read the file
        JSONArray array = fileHandler.readFile();

        // Parse the teachers
        ArrayList<String> parsedTeachers = fileHandler.parseTeachers(array);

        // Testing expected output -> "Alice English,Maths"
        //                         -> "Bob English, Science"
        //                         -> "Charlie Maths,Science"
        for (String string : parsedTeachers) {
            System.out.println(string);
        }
    }
    
    // Constructor
    public FileHandler() {
        this.jsonFile = "TeachingRequirements.json";
    }

    // Read JSON file
    public JSONArray readFile() {
        
        JSONParser parser = new JSONParser();
		try {
			Object obj = parser.parse(new FileReader(jsonFile));
            String string = obj.toString();
            JSONArray array = new JSONArray(string);
            return array;
			
		} catch (Exception e) {
			e.printStackTrace();
		}
        return null;
    }
   
    // Parse teachers
    public static ArrayList<String> parseTeachers(JSONArray array) {

        ArrayList<String> parsedTeachers = new ArrayList<String>();
       
        // 0th element of JSONArray input is the list of teacher objects
        JSONArray teacherArray = array.getJSONArray(0);
         
            // Iterate over teacher list
            for (int i = 0; i < teacherArray.length(); i++) {

                // Access individual teacher object
                JSONObject outerTeacherObject = teacherArray.getJSONObject(i);
                JSONObject inner = outerTeacherObject.getJSONObject("Teacher");

                // Parse teacher name
                String name = inner.getString("Name");

                // Parsing teacher training
                JSONArray trainingArray = inner.getJSONArray("TrainingAttended");
                String trainingAttended = "";

                // Iterator over training array
                Iterator<Object> it = trainingArray.iterator();
                if (it.hasNext()) {
                    trainingAttended += it.next();
                }
                while (it.hasNext()) {
                    trainingAttended += ("," + it.next());
                }

                String outStream = String.format("%s %s", name, trainingAttended);
                parsedTeachers.add(outStream);  
            }  
        return parsedTeachers;
    }

    // Parse courses

    // Write updated courses (assigned teachers)

    // Write updated teachers (assigned training)

    // Generate JSON file
    public void fileWrite() {
        
        // Teachers
        
        // Teacher 1
        JSONObject teacherDetails1 = new JSONObject();
        teacherDetails1.put("Name", "Alice");

        JSONArray trainingAttendedAlice = new JSONArray();
        trainingAttendedAlice.put("English");
        trainingAttendedAlice.put("Maths");
        teacherDetails1.put("TrainingAttended", trainingAttendedAlice);

        JSONArray trainingToAttendAlice = new JSONArray();
        teacherDetails1.put("TrainingToAttend", trainingToAttendAlice);

        JSONObject teacherObject1 = new JSONObject();
        teacherObject1.put("Teacher", teacherDetails1);

        // Teacher 2
        JSONObject teacherDetails2 = new JSONObject();
        teacherDetails2.put("Name", "Bob");

        JSONArray trainingAttendedBob = new JSONArray();
        trainingAttendedBob.put("English");
        trainingAttendedBob.put("Science");
        teacherDetails2.put("TrainingAttended", trainingAttendedBob);

        JSONArray trainingToAttendBob = new JSONArray();
        teacherDetails2.put("TrainingToAttend", trainingToAttendBob);

        JSONObject teacherObject2 = new JSONObject();
        teacherObject2.put("Teacher", teacherDetails2);

        // Teacher 3
        JSONObject teacherDetails3 = new JSONObject();
        teacherDetails3.put("Name", "Charlie");

        JSONArray trainingAttendedCharlie = new JSONArray();
        trainingAttendedCharlie.put("Maths");
        trainingAttendedCharlie.put("Science");
        teacherDetails3.put("TrainingAttended", trainingAttendedCharlie);

        JSONArray trainingToAttendCharlie = new JSONArray();
        teacherDetails3.put("TrainingToAttend", trainingToAttendCharlie);

        JSONObject teacherObject3 = new JSONObject();
        teacherObject3.put("Teacher", teacherDetails3);

        // Add teachers to the list
        JSONArray teacherList = new JSONArray();
        teacherList.put(teacherObject1);
        teacherList.put(teacherObject2);
        teacherList.put(teacherObject3);

        // Wrap in object
        JSONObject teacherListObject = new JSONObject();
        teacherListObject.put("Teachers", teacherList);

        // Courses

        // Course 1
        JSONObject courseDetails1 = new JSONObject();
        courseDetails1.put("CourseName", "English");
        courseDetails1.put("NumStaff", 2);

        JSONArray TrainingRequired = new JSONArray();
        TrainingRequired.put("English");
        courseDetails1.put("TrainingRequired", TrainingRequired);

        JSONArray TeachersAssinged = new JSONArray();
        courseDetails1.put("TeachersAssigned", TeachersAssinged);

        JSONObject courseObject = new JSONObject();
        courseObject.put("Course", courseDetails1);

        // Course 2
        JSONObject courseDetails2 = new JSONObject();
        courseDetails2.put("CourseName", "Science");
        courseDetails2.put("NumStaff", 2);

        JSONArray TrainingRequired2 = new JSONArray();
        TrainingRequired2.put("Maths");
        TrainingRequired2.put("Science");
        courseDetails2.put("TrainingRequired", TrainingRequired2);

        JSONArray TeachersAssinged2 = new JSONArray();
        courseDetails2.put("TeachersAssigned", TeachersAssinged2);

        JSONObject courseObject2 = new JSONObject();
        courseObject2.put("Course", courseDetails2);
        
        // Add courses to the list
        JSONArray courseList = new JSONArray();
        courseList.put(courseDetails1);
        courseList.put(courseDetails2);

        // Wrap in object
        JSONObject courseListObject = new JSONObject();
        courseListObject.put("Courses", courseListObject);
        
        // JSON array to hold teacher and course lists objects
        JSONArray teacherAndCourseList = new JSONArray();
        teacherAndCourseList.put(teacherList);
        teacherAndCourseList.put(courseList);

        // Making the file look nice
        Gson gson = new GsonBuilder().setPrettyPrinting().create();
        JsonParser jp = new JsonParser();
        JsonElement je = jp.parse(teacherAndCourseList.toString());
        String prettyJsonString = gson.toJson(je);

        // Write the JSON file
        try (FileWriter file = new FileWriter(jsonFile)) {
            // Write the 'prettyString' to the file
            file.write(prettyJsonString); 
            file.flush();
 
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}

